<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Game CSV Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Custom scrollbar for better aesthetics */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-900 text-slate-100">
  <div id="root"></div>
  <script type="text/babel" data-presets="react,typescript" data-type="module">
    // --- IMPORTS ---
    import React, { useState, useCallback } from 'react';
    import ReactDOM from 'react-dom/client';
    import { GoogleGenAI, Type } from "@google/genai";

    // --- TYPES ---
    interface ProcessedGameData {
      // Core fields
      gameCode: string; // From input 'gameCode'
      name: string; // From input 'name'
      isActive: boolean; // Hardcoded to true
      mobileGameCode?: string; // From input 'mobileGameCode' or defaults to gameCode
      seoFriendlyGameName: string; // From input 'seoFriendlyGameName' or generated
      defaultGameImage: string; // Generated or from 'defaultUserImage'

      // Game details
      desktopGameType?: string;
      mobileGameType?: string;
      liveLaunchAlias?: string;
      bingoGameType?: string;
      vfGameType?: string;
      jackpotCode?: string;
      demoModeSupport?: string; // Hardcoded to "unavailable"
      gameMode?: string; // Hardcoded to "Maintenance"
      gameProvider?: string; // From input 'gameProvider'
      urlCustomParameters?: string;
      isExcludedFromPGG: boolean;
      isExcludedFromSitemap: boolean; // Parsed to boolean

      // Availability - all parsed to boolean
      deviceAvailability_mobile: boolean;
      deviceAvailability_tablet: boolean;
      deviceAvailability_desktop: boolean;
      browserAvailability_edge: boolean;
      browserAvailability_safari: boolean;
      browserAvailability_chrome: boolean;
      browserAvailability_firefox: boolean;
      browserAvailability_other: boolean;
      osAvailability_ios: boolean;
      osAvailability_macintosh: boolean;
      osAvailability_android: boolean;
      osAvailability_windows: boolean;
      osAvailability_other: boolean;

      // Image URLs
      landscape_layout1x1_mainImage?: string;
      landscape_layout1x1_mobileImage?: string;
      landscape_layout1x1_guestMainImage?: string;
      landscape_layout1x1_guestMobileImage?: string;
      landscape_layout1x2_mainImage?: string;
      landscape_layout1x2_mobileImage?: string;
      landscape_layout1x2_guestMainImage?: string;
      landscape_layout1x2_guestMobileImage?: string;
      landscape_layout2x1_mainImage?: string;
      landscape_layout2x1_mobileImage?: string;
      landscape_layout2x1_guestMainImage?: string;
      landscape_layout2x1_guestMobileImage?: string;
      landscape_layout2x2_mainImage?: string;
      landscape_layout2x2_mobileImage?: string;
      landscape_layout2x2_guestMainImage?: string;
      landscape_layout2x2_guestMobileImage?: string;

      portrait_layout1x1_mainImage?: string;
      portrait_layout1x1_mobileImage?: string;
      portrait_layout1x1_guestMainImage?: string;
      portrait_layout1x1_guestMobileImage?: string;
      portrait_layout1x2_mainImage?: string;
      portrait_layout1x2_mobileImage?: string;
      portrait_layout1x2_guestMainImage?: string;
      portrait_layout1x2_guestMobileImage?: string;
      portrait_layout2x1_mainImage?: string;
      portrait_layout2x1_mobileImage?: string;
      portrait_layout2x1_guestMainImage?: string;
      portrait_layout2x1_guestMobileImage?: string;
      portrait_layout2x2_mainImage?: string;
      portrait_layout2x2_mobileImage?: string;
      portrait_layout2x2_guestMainImage?: string;
      portrait_layout2x2_guestMobileImage?: string;

      square_layout1x1_mainImage?: string;
      square_layout1x1_mobileImage?: string;
      square_layout1x1_guestMainImage?: string;
      square_layout1x1_guestMobileImage?: string;
      square_layout1x2_mainImage?: string;
      square_layout1x2_mobileImage?: string;
      square_layout1x2_guestMainImage?: string;
      square_layout1x2_guestMobileImage?: string;
      square_layout2x1_mainImage?: string;
      square_layout2x1_mobileImage?: string;
      square_layout2x1_guestMainImage?: string;
      square_layout2x1_guestMobileImage?: string;
      square_layout2x2_mainImage?: string;
      square_layout2x2_mobileImage?: string;
      square_layout2x2_guestMainImage?: string;
      square_layout2x2_guestMobileImage?: string;
      
      // Other metadata
      articleId?: string; // Renamed from slotId
      mobileArticleId?: string;
      description?: string;
      isGameNew: boolean;
      isGamePopular: boolean; // Parsed to boolean
      isGameHot: boolean; // Parsed to boolean
      isGameExclusive: boolean; // Game-level exclusive flag, parsed to boolean

      // Labels
      ['gameLabelsData_Drops and Wins']?: string; // Property name with space for exact CSV header
      ['gameLabelsData_Rising Star']?: string;
      gameLabelsData_Exclusive?: string; // Label specific exclusive
      gameLabelsData_New?: string;

      // Custom fields
      gamesCustomFields_provider?: string;
      gamesCustomFields_externalProviderGameId?: string; // Renamed from gamesCustomFields_providerGameId
      gamesCustomFields_gameType?: string;
      gamesCustomFields_theme?: string;
      gamesCustomFields_features?: string;
      gamesCustomFields_volatility?: string;
      gamesCustomFields_rtp?: string;
      gamesCustomFields_lines?: string;
      gamesCustomFields_reels?: string;
    }

    interface GameProviderFolderMapping {
      [providerName: string]: string;
    }

    // --- CONSTANTS ---
    const APP_TITLE = "Portal Game CSV Generator";

    const GAME_PROVIDER_TO_FOLDER_MAP_CA: GameProviderFolderMapping = {
      "AGS": "AGS",
      "Greentube": "Green Tube",
      "Pragmatic": "Pragmatic",
      "Games Global": "games-global",
      "Hacksaw": "Hacksaw",
      "HACKSAW OpenRGS": "Hacksaw",
      "HACKSAW": "Hacksaw", // Added for all-caps input
      "ELK-Studios": "ELK-Studios",
      "ELK Studios via LNW": "ELK-Studios",
      "ELK Studios": "ELK-Studios",
      "Gaming Realms": "Gaming Realms",
      "High 5": "High 5",
      "High5 via SG": "High 5",
      "Lightning Box": "Lightning Box",
      "Peter & Sons": "Peter & Sons",
      "Quickspin": "Quickspin",
      "SG": "SG",
      "Wazdan": "Wazdan",
      "Blueprint": "Blueprint",
      "Bragg": "Bragg",
      "eyecon": "eyecon",
      "Eyecon": "eyecon", // Added for case-insensitivity
      "IGT": "IGT",
      "Konami": "Konami",
      "Konami via SG": "Konami",
      "Inspired": "Inspired",
      "Live Casino": "Live Casino",
      "Oryx": "Oryx",
      "Playtech": "Playtech",
      "Relax Gaming": "Relax Gaming",
      "SkyWind": "SkyWind",
      "Skywind": "SkyWind", // Ensure consistent folder casing
      "Drops & Wins": "Drops & Wins",
      "RubyPlay": "Rubyplay", // Custom folder name for CA export
      "Test": "Test" // Added based on COM screenshot
    };

    const GAME_PROVIDER_TO_FOLDER_MAP_COM: GameProviderFolderMapping = {
      // From screenshot - these take precedence
      "Blueprint": "Blueprint",
      "Bragg": "Bragg",
      "Drops & Wins": "Drops & Wins",
      "Games Global": "Games Global", // Screenshot: "Games Global" (CA: "games-global")
      "Live Casino": "Live Casino",
      "Oryx": "Oryx",
      "Peter & Sons": "Peter & Sons",
      "Playtech": "Playtech",
      "Pragmatic": "Pragmatic",
      "Quickspin": "Quickspin",
      "RubyPlay": "RubyPlay",
      "Test": "Test",

      // Providers from CA map NOT in screenshot - maintain consistency or use direct name
      "AGS": "AGS",
      "Greentube": "Greentube", // CA was "Green Tube", using direct name for COM
      "Hacksaw": "Hacksaw",
      "HACKSAW OpenRGS": "Hacksaw",
      "HACKSAW": "Hacksaw", // Added for all-caps input
      "ELK-Studios": "ELK-Studios",
      "ELK Studios via LNW": "ELK-Studios",
      "ELK Studios": "ELK-Studios",
      "Gaming Realms": "Gaming Realms",
      "High 5": "High 5",
      "High5 via SG": "High 5",
      "Lightning Box": "Lightning Box",
      "SG": "SG",
      "Wazdan": "Wazdan",
      "eyecon": "eyecon",
      "Eyecon": "eyecon", // Added for case-insensitivity
      "IGT": "IGT",
      "Konami": "Konami",
      "Konami via SG": "Konami",
      "Inspired": "Inspired",
      "Relax Gaming": "Relax Gaming",
      "SkyWind": "SkyWind",
      "Skywind": "SkyWind", // Ensure consistent folder casing
    };


    const INPUT_HEADER_MAPPINGS = {
      GAME_CODE: "IMS Game Code",
      NAME: "Name",
      IS_ACTIVE: "isActive",
      MOBILE_GAME_CODE: "mobileGameCode",
      SEO_FRIENDLY_GAME_NAME: "seoFriendlyGameName",
      DESKTOP_GAME_TYPE: "desktopGameType",
      MOBILE_GAME_TYPE: "mobileGameType",
      LIVE_LAUNCH_ALIAS: "liveLaunchAlias",
      BINGO_GAME_TYPE: "bingoGameType",
      RTP_GAME_TYPE: "rtpGameType",
      JACKPOT_CODE: "jackpotCode",
      DEMO_MODE_SUPPORT: "defaultSlotModeSupport",
      GAME_MODE: "gameMode",
      GAME_PROVIDER: "Game Provider",
      URL_CUSTOM_PARAMETERS: "urlCustomParameters",
      IS_EXCLUDED_FROM_PGG: "isExcludedFromRGS",
      IS_EXCLUDED_FROM_SITEMAP: "isExcludedFromSitemap",
      DEVICE_AVAILABILITY_MOBILE: "deviceAvailability_mobile",
      DEVICE_AVAILABILITY_TABLET: "deviceAvailability_tablet",
      DEVICE_AVAILABILITY_DESKTOP: "deviceAvailability_desktop",
      BROWSER_AVAILABILITY_EDGE: "browserAvailability_edge",
      BROWSER_AVAILABILITY_SAFARI: "browserAvailability_safari",
      BROWSER_AVAILABILITY_CHROME: "browserAvailability_chrome",
      BROWSER_AVAILABILITY_FIREFOX: "browserAvailability_firefox",
      BROWSER_AVAILABILITY_OTHER: "browserAvailability_other",
      OS_AVAILABILITY_IOS: "osAvailability_ios",
      OS_AVAILABILITY_MACINTOSH: "osAvailability_macintosh",
      OS_AVAILABILITY_ANDROID: "osAvailability_android",
      OS_AVAILABILITY_WINDOWS: "osAvailability_windows",
      OS_AVAILABILITY_OTHER: "osAvailability_other",
      DEFAULT_USER_IMAGE: "defaultUserImage",

      LANDSCAPE_LAYOUT_1X1_MAIN_IMAGE: "landscape_layout1x1_mainImage",
      LANDSCAPE_LAYOUT_1X1_MOBILE_IMAGE: "landscape_layout1x1_mobileImage",
      LANDSCAPE_LAYOUT_1X1_GUEST_MAIN_IMAGE: "landscape_layout1x1_guestMainImage",
      LANDSCAPE_LAYOUT_1X1_GUEST_MOBILE_IMAGE: "landscape_layout1x1_guestMobileImage",
      LANDSCAPE_LAYOUT_1X2_MAIN_IMAGE: "landscape_layout1x2_mainImage",
      LANDSCAPE_LAYOUT_1X2_MOBILE_IMAGE: "landscape_layout1x2_mobileImage",
      LANDSCAPE_LAYOUT_1X2_GUEST_MAIN_IMAGE: "landscape_layout1x2_guestMainImage",
      LANDSCAPE_LAYOUT_1X2_GUEST_MOBILE_IMAGE: "landscape_layout1x2_guestMobileImage",
      LANDSCAPE_LAYOUT_2X1_MAIN_IMAGE: "landscape_layout2x1_mainImage",
      LANDSCAPE_LAYOUT_2X1_MOBILE_IMAGE: "landscape_layout2x1_mobileImage",
      LANDSCAPE_LAYOUT_2X1_GUEST_MAIN_IMAGE: "landscape_layout2x1_guestMainImage",
      LANDSCAPE_LAYOUT_2X1_GUEST_MOBILE_IMAGE: "landscape_layout2x1_guestMobileImage",
      LANDSCAPE_LAYOUT_2X2_MAIN_IMAGE: "landscape_layout2x2_mainImage",
      LANDSCAPE_LAYOUT_2X2_MOBILE_IMAGE: "landscape_layout2x2_mobileImage",
      LANDSCAPE_LAYOUT_2X2_GUEST_MAIN_IMAGE: "landscape_layout2x2_guestMainImage",
      LANDSCAPE_LAYOUT_2X2_GUEST_MOBILE_IMAGE: "landscape_layout2x2_guestMobileImage",

      PORTRAIT_LAYOUT_1X1_MAIN_IMAGE: "portrait_layout1x1_mainImage",
      PORTRAIT_LAYOUT_1X1_MOBILE_IMAGE: "portrait_layout1x1_mobileImage",
      PORTRAIT_LAYOUT_1X1_GUEST_MAIN_IMAGE: "portrait_layout1x1_guestMainImage",
      PORTRAIT_LAYOUT_1X1_GUEST_MOBILE_IMAGE: "portrait_layout1x1_guestMobileImage",
      PORTRAIT_LAYOUT_1X2_MAIN_IMAGE: "portrait_layout1x2_mainImage",
      PORTRAIT_LAYOUT_1X2_MOBILE_IMAGE: "portrait_layout1x2_mobileImage",
      PORTRAIT_LAYOUT_1X2_GUEST_MAIN_IMAGE: "portrait_layout1x2_guestMainImage",
      PORTRAIT_LAYOUT_1X2_GUEST_MOBILE_IMAGE: "portrait_layout1x2_guestMobileImage",
      PORTRAIT_LAYOUT_2X1_MAIN_IMAGE: "portrait_layout2x1_mainImage",
      PORTRAIT_LAYOUT_2X1_MOBILE_IMAGE: "portrait_layout2x1_mobileImage",
      PORTRAIT_LAYOUT_2X1_GUEST_MAIN_IMAGE: "portrait_layout2x1_guestMainImage",
      PORTRAIT_LAYOUT_2X1_GUEST_MOBILE_IMAGE: "portrait_layout2x1_guestMobileImage",
      PORTRAIT_LAYOUT_2X2_MAIN_IMAGE: "portrait_layout2x2_mainImage",
      PORTRAIT_LAYOUT_2X2_MOBILE_IMAGE: "portrait_layout2x2_mobileImage",
      PORTRAIT_LAYOUT_2X2_GUEST_MAIN_IMAGE: "portrait_layout2x2_guestMainImage",
      PORTRAIT_LAYOUT_2X2_GUEST_MOBILE_IMAGE: "portrait_layout2x2_guestMobileImage",

      SQUARE_LAYOUT_1X1_MAIN_IMAGE: "square_layout1x1_mainImage",
      SQUARE_LAYOUT_1X1_MOBILE_IMAGE: "square_layout1x1_mobileImage",
      SQUARE_LAYOUT_1X1_GUEST_MAIN_IMAGE: "square_layout1x1_guestMainImage",
      SQUARE_LAYOUT_1X1_GUEST_MOBILE_IMAGE: "square_layout1x1_guestMobileImage",
      SQUARE_LAYOUT_1X2_MAIN_IMAGE: "square_layout1x2_mainImage",
      SQUARE_LAYOUT_1X2_MOBILE_IMAGE: "square_layout1x2_mobileImage",
      SQUARE_LAYOUT_1X2_GUEST_MAIN_IMAGE: "square_layout1x2_guestMainImage",
      SQUARE_LAYOUT_1X2_GUEST_MOBILE_IMAGE: "square_layout1x2_guestMobileImage",
      SQUARE_LAYOUT_2X1_MAIN_IMAGE: "square_layout2x1_mainImage",
      SQUARE_LAYOUT_2X1_MOBILE_IMAGE: "square_layout2x1_mobileImage",
      SQUARE_LAYOUT_2X1_GUEST_MAIN_IMAGE: "square_layout2x1_guestMainImage",
      SQUARE_LAYOUT_2X1_GUEST_MOBILE_IMAGE: "square_layout2x1_guestMobileImage",
      SQUARE_LAYOUT_2X2_MAIN_IMAGE: "square_layout2x2_mainImage",
      SQUARE_LAYOUT_2X2_MOBILE_IMAGE: "square_layout2x2_mobileImage",
      SQUARE_LAYOUT_2X2_GUEST_MAIN_IMAGE: "square_layout2x2_guestMainImage",
      SQUARE_LAYOUT_2X2_GUEST_MOBILE_IMAGE: "square_layout2x2_guestMobileImage",
      
      // New tile status fields from Monday.com
      PORTRAIT_TILE_STATUS: "Portrait Tile",
      LANDSCAPE_TILE_STATUS: "Landscape tile",

      ARTICLE_ID: "articleId",
      MOBILE_ARTICLE_ID: "mobileArticleId",
      DESCRIPTION: "description",
      IS_GAME_NEW: "isGameAllen",
      IS_GAME_POPULAR: "isGamePopular",
      IS_GAME_HOT: "isGameHot",
      IS_GAME_EXCLUSIVE: "isGameExclusive",
      GAMELABELS_DROPS_AND_WINS: "gameLabelsData_Drops and Wins",
      GAMELABELS_RISING_STAR: "gameLabelsData_Rising Star",
      GAMELABELS_EXCLUSIVE: "gameLabelsData_Exclusive",
      GAMELABELS_NEW: "gameLabelsData_New",
      GAMESCUSTOMFIELDS_PROVIDER: "gamesCustomFields_provider",
      GAMESCUSTOMFIELDS_EXTERNALPROVIDERGAMEID: "gamesCustomFields_externalProviderGameId",
      GAMESCUSTOMFIELDS_GAMETYPE: "gamesCustomFields_gameType",
      GAMESCUSTOMFIELDS_THEME: "gamesCustomFields_theme",
      GAMESCUSTOMFIELDS_FEATURES: "gamesCustomFields_features",
      GAMESCUSTOMFIELDS_VOLATILITY: "gamesCustomFields_volatility",
      GAMESCUSTOMFIELDS_RTP: "gamesCustomFields_rtp",
      GAMESCUSTOMFIELDS_LINES: "gamesCustomFields_lines",
      GAMESCUSTOMFIELDS_REELS: "gamesCustomFields_reels",
    };

    const CORE_REQUIRED_INPUT_HEADER_KEYS: string[] = [
      'GAME_CODE',
      'NAME',
      'GAME_PROVIDER',
    ];

    const PLACEHOLDER_INFO_REQUIRED_COLUMNS = "Core required headers: IMS Game Code, Name, Game Provider.";

    const OUTPUT_CSV_COLUMNS: (keyof ProcessedGameData | 'gameLabelsData_Drops and Wins' | 'gameLabelsData_Rising Star')[] = [
      'gameCode',
      'name',
      'isActive',
      'mobileGameCode',
      'seoFriendlyGameName',
      'desktopGameType',
      'mobileGameType',
      'liveLaunchAlias',
      'bingoGameType',
      'vfGameType',
      'jackpotCode',
      'demoModeSupport',
      'gameMode',
      'gameProvider',
      'urlCustomParameters',
      'isExcludedFromPGG',
      'isExcludedFromSitemap',
      'deviceAvailability_mobile',
      'deviceAvailability_tablet',
      'deviceAvailability_desktop',
      'browserAvailability_edge',
      'browserAvailability_safari',
      'browserAvailability_chrome',
      'browserAvailability_firefox',
      'browserAvailability_other',
      'osAvailability_ios',
      'osAvailability_macintosh',
      'osAvailability_android',
      'osAvailability_windows',
      'osAvailability_other',
      'defaultGameImage',
      'landscape_layout1x1_mainImage',
      'landscape_layout1x1_mobileImage',
      'landscape_layout1x1_guestMainImage',
      'landscape_layout1x1_guestMobileImage',
      'landscape_layout1x2_mainImage',
      'landscape_layout1x2_mobileImage',
      'landscape_layout1x2_guestMainImage',
      'landscape_layout1x2_guestMobileImage',
      'landscape_layout2x1_mainImage',
      'landscape_layout2x1_mobileImage',
      'landscape_layout2x1_guestMainImage',
      'landscape_layout2x1_guestMobileImage',
      'landscape_layout2x2_mainImage',
      'landscape_layout2x2_mobileImage',
      'landscape_layout2x2_guestMainImage',
      'landscape_layout2x2_guestMobileImage',
      'square_layout1x1_mainImage',
      'square_layout1x1_mobileImage',
      'square_layout1x1_guestMainImage',
      'square_layout1x1_guestMobileImage',
      'square_layout1x2_mainImage',
      'square_layout1x2_mobileImage',
      'square_layout1x2_guestMainImage',
      'square_layout1x2_guestMobileImage',
      'square_layout2x1_mainImage',
      'square_layout2x1_mobileImage',
      'square_layout2x1_guestMainImage',
      'square_layout2x1_guestMobileImage',
      'square_layout2x2_mainImage',
      'square_layout2x2_mobileImage',
      'square_layout2x2_guestMainImage',
      'square_layout2x2_guestMobileImage',
      'portrait_layout1x1_mainImage',
      'portrait_layout1x1_mobileImage',
      'portrait_layout1x1_guestMainImage',
      'portrait_layout1x1_guestMobileImage',
      'portrait_layout1x2_mainImage',
      'portrait_layout1x2_mobileImage',
      'portrait_layout1x2_guestMainImage',
      'portrait_layout1x2_guestMobileImage',
      'portrait_layout2x1_mainImage',
      'portrait_layout2x1_mobileImage',
      'portrait_layout2x1_guestMainImage',
      'portrait_layout2x1_guestMobileImage',
      'portrait_layout2x2_mainImage',
      'portrait_layout2x2_mobileImage',
      'portrait_layout2x2_guestMainImage',
      'portrait_layout2x2_guestMobileImage',
      'articleId',
      'mobileArticleId',
      'description',
      'isGameNew',
      'isGamePopular',
      'isGameHot',
      'isGameExclusive',
      'gameLabelsData_Drops and Wins',
      'gameLabelsData_Rising Star',
      'gameLabelsData_Exclusive',
      'gameLabelsData_New',
      'gamesCustomFields_gameType',
      'gamesCustomFields_theme',
      'gamesCustomFields_features',
      'gamesCustomFields_volatility',
      'gamesCustomFields_rtp',
      'gamesCustomFields_lines',
      'gamesCustomFields_reels',
      'gamesCustomFields_provider',
      'gamesCustomFields_externalProviderGameId',
    ];

    // --- SERVICES ---
    function generateSeoFriendlyName(name: string): string {
      if (!name) return '';
      return name
        .toLowerCase()
        .replace(/™/g, '') // Remove trademark symbol
        .replace(/®/g, '') // Remove registered symbol
        .replace(/©/g, '') // Remove copyright symbol
        .replace(/%/g, '')  // Remove percentage sign
        .replace(/&/g, 'and') // Replace ampersand
        .replace(/[^\w\s-]/g, '') // Remove non-alphanumeric, keeping spaces and hyphens
        .trim() // Trim leading/trailing whitespace
        .replace(/\s+/g, '-') // Replace spaces (single or multiple) with a single hyphen
        .replace(/-+/g, '-') // Replace multiple hyphens with a single hyphen
        .replace(/^-+|-+$/g, ''); // Trim leading/trailing hyphens
    }

    function parseBooleanString(value: string | undefined, defaultValue: boolean = false): boolean {
        if (value === undefined || value === null) {
            return defaultValue;
        }
        const lowerValue = value.trim().toLowerCase();
        if (lowerValue === 'true' || lowerValue === '1') {
            return true;
        }
        if (lowerValue === 'false' || lowerValue === '0') {
            return false;
        }
        return defaultValue;
    }


    function parsePastedData(
      text: string,
      providerMap: GameProviderFolderMapping // Accept providerMap as an argument
    ): ProcessedGameData[] {
      const lines = text.trim().split('\n');
      if (lines.length < 2) {
        throw new Error("Data must include a header row and at least one data row.");
      }

      const headerCells = lines[0].split('\t').map(cell => cell.trim());
      const headerIndices: { [internalKey: string]: number } = {};
      const missingRequiredHeaders: string[] = [];

      for (const internalKey in INPUT_HEADER_MAPPINGS) {
        const expectedHeader = (INPUT_HEADER_MAPPINGS as any)[internalKey];
        const index = headerCells.indexOf(expectedHeader);
        if (index !== -1) {
          headerIndices[internalKey] = index;
        } else {
          if (CORE_REQUIRED_INPUT_HEADER_KEYS.includes(internalKey)) {
            missingRequiredHeaders.push(expectedHeader);
          }
        }
      }

      if (missingRequiredHeaders.length > 0) {
        throw new Error(`Missing required headers: ${missingRequiredHeaders.join(', ')}.`);
      }
      
      const processedGames: ProcessedGameData[] = [];

      const providerDisplayNameMap: { [key: string]: string } = {
        'pragmatic': 'Pragmatic Play',
        'sg': 'Light and Wonder',
        'peter & sons': 'Peter and Sons',
        'hacksaw': 'Hacksaw',
        'hacksaw openrgs': 'Hacksaw',
      };

      const processExistingImagePath = (pathValue: string | undefined): string | undefined => {
          if (!pathValue) return undefined;
          const trimmedPath = pathValue.trim();
          if (trimmedPath.startsWith('http://') || trimmedPath.startsWith('https://')) {
              return trimmedPath;
          }
          let path = trimmedPath;
          if (path.startsWith('/')) {
              path = path.substring(1);
          }
          if (path.toLowerCase().startsWith('library/')) {
              return `/${path}`;
          } else {
              return `/library/${path}`;
          }
      };


      for (let i = 1; i < lines.length; i++) {
        const cells = lines[i].split('\t');
        
        const getCellValue = (internalKey: string): string | undefined => {
          const index = headerIndices[internalKey];
          return index !== undefined ? cells[index]?.trim() : undefined;
        };

        const gameCode = getCellValue('GAME_CODE');
        const name = getCellValue('NAME');
        const originalGameProvider = getCellValue('GAME_PROVIDER'); 

        if (!gameCode || !name || !originalGameProvider) {
          console.warn(`Skipping line ${i + 1}: Missing core data (gameCode, name, or gameProvider).`);
          continue;
        }

        const lowerCaseProvider = originalGameProvider.trim().toLowerCase();
        let finalGameProvider: string;
        let providerForImageUrl: string;

        if (lowerCaseProvider.includes(' via bragg')) {
            finalGameProvider = originalGameProvider.replace(/ via bragg/i, '').trim();
            providerForImageUrl = 'Bragg';
        } else if (lowerCaseProvider.includes(' via sg') || lowerCaseProvider.includes(' via lnw')) {
            finalGameProvider = originalGameProvider.replace(/ via sg/i, '').replace(/ via lnw/i, '').trim();
            
            if (finalGameProvider.toLowerCase() === 'high5') {
                finalGameProvider = 'High 5';
            } else if (finalGameProvider.toLowerCase() === 'lightning box') {
                finalGameProvider = 'Lightning Box';
            }

            if (finalGameProvider.toLowerCase().startsWith('elk studio')) {
                providerForImageUrl = finalGameProvider;
            } else {
                providerForImageUrl = 'SG';
            }
        } else {
            finalGameProvider = providerDisplayNameMap[lowerCaseProvider] || originalGameProvider;
            providerForImageUrl = originalGameProvider;
        }


        let seoFriendlyGameName = getCellValue('SEO_FRIENDLY_GAME_NAME');
        if (!seoFriendlyGameName) {
          seoFriendlyGameName = generateSeoFriendlyName(name);
        }
        
        const folderNameFromMap = providerMap[providerForImageUrl];
        const providerFolderName = folderNameFromMap || providerForImageUrl; 
        const encodedFolderName = encodeURIComponent(providerFolderName);
        const baseIconPath = `/library/Game%20Icons/${encodedFolderName}`;

        let defaultGameImage: string;
        const defaultUserImageValue = getCellValue('DEFAULT_USER_IMAGE');
        const processedDefaultUserImage = processExistingImagePath(defaultUserImageValue);
        if (processedDefaultUserImage) {
            defaultGameImage = processedDefaultUserImage;
        } else {
            defaultGameImage = `${baseIconPath}/${gameCode}.webp`;
        }
        
        let landscape_layout1x1_mainImage: string | undefined;
        const landscapeImageValue = getCellValue('LANDSCAPE_LAYOUT_1X1_MAIN_IMAGE');
        const landscapeTileStatus = getCellValue('LANDSCAPE_TILE_STATUS');
        const processedLandscapeImage = processExistingImagePath(landscapeImageValue);
        
        if (processedLandscapeImage) {
            landscape_layout1x1_mainImage = processedLandscapeImage;
        } else if (landscapeTileStatus?.trim().toLowerCase() === 'done') {
            landscape_layout1x1_mainImage = `${baseIconPath}/landscape/${gameCode}.webp`;
        }
        
        let portrait_layout1x1_mainImage: string | undefined;
        const portraitImageValue = getCellValue('PORTRAIT_LAYOUT_1X1_MAIN_IMAGE');
        const portraitTileStatus = getCellValue('PORTRAIT_TILE_STATUS');
        const processedPortraitImage = processExistingImagePath(portraitImageValue);
        
        if (processedPortraitImage) {
            portrait_layout1x1_mainImage = processedPortraitImage;
        } else if (portraitTileStatus?.trim().toLowerCase() === 'done') {
            portrait_layout1x1_mainImage = `${baseIconPath}/portrait/${gameCode}.webp`;
        }
        
        const mobileGameCode = getCellValue('MOBILE_GAME_CODE') || gameCode;

        let desktopGameTypeFinal = "POP";
        let mobileGameTypeFinal = "POP";
        let liveLaunchAliasValue = getCellValue('LIVE_LAUNCH_ALIAS'); 

        if (lowerCaseProvider === "playtech") {
          desktopGameTypeFinal = "GPAS";
          mobileGameTypeFinal = "GPAS";
        } else if (lowerCaseProvider === "playtech live") {
          desktopGameTypeFinal = "LIVE";
          mobileGameTypeFinal = "LIVE";
          liveLaunchAliasValue = gameCode; 
        }

        const rowData: ProcessedGameData = {
          gameCode, 
          name,
          gameProvider: finalGameProvider, 
          mobileGameCode,
          seoFriendlyGameName,
          defaultGameImage,
          isActive: true,
          isExcludedFromPGG: parseBooleanString(getCellValue('IS_EXCLUDED_FROM_PGG')),
          isExcludedFromSitemap: false, 
          deviceAvailability_mobile: true,
          deviceAvailability_tablet: true,
          deviceAvailability_desktop: true,
          browserAvailability_edge: true,
          browserAvailability_safari: true,
          browserAvailability_chrome: true,
          browserAvailability_firefox: true,
          browserAvailability_other: true,
          osAvailability_ios: true,
          osAvailability_macintosh: true,
          osAvailability_android: true,
          osAvailability_windows: true,
          osAvailability_other: true,
          isGameNew: parseBooleanString(getCellValue('IS_GAME_NEW'), true), 
          isGamePopular: parseBooleanString(getCellValue('IS_GAME_POPULAR')),
          isGameHot: parseBooleanString(getCellValue('IS_GAME_HOT')),
          isGameExclusive: parseBooleanString(getCellValue('IS_GAME_EXCLUSIVE')),

          desktopGameType: desktopGameTypeFinal,
          mobileGameType: mobileGameTypeFinal,
          liveLaunchAlias: liveLaunchAliasValue, 
          bingoGameType: getCellValue('BINGO_GAME_TYPE'),
          vfGameType: getCellValue('RTP_GAME_TYPE'), 
          jackpotCode: getCellValue('JACKPOT_CODE'),
          demoModeSupport: "unavailable", 
          gameMode: "Maintenance", 
          urlCustomParameters: getCellValue('URL_CUSTOM_PARAMETERS'),
          
          landscape_layout1x1_mainImage: landscape_layout1x1_mainImage,
          landscape_layout1x1_mobileImage: getCellValue('LANDSCAPE_LAYOUT_1X1_MOBILE_IMAGE'),
          landscape_layout1x1_guestMainImage: getCellValue('LANDSCAPE_LAYOUT_1X1_GUEST_MAIN_IMAGE'),
          landscape_layout1x1_guestMobileImage: getCellValue('LANDSCAPE_LAYOUT_1X1_GUEST_MOBILE_IMAGE'),
          landscape_layout1x2_mainImage: getCellValue('LANDSCAPE_LAYOUT_1X2_MAIN_IMAGE'),
          landscape_layout1x2_mobileImage: getCellValue('LANDSCAPE_LAYOUT_1X2_MOBILE_IMAGE'),
          landscape_layout1x2_guestMainImage: getCellValue('LANDSCAPE_LAYOUT_1X2_GUEST_MAIN_IMAGE'),
          landscape_layout1x2_guestMobileImage: getCellValue('LANDSCAPE_LAYOUT_1X2_GUEST_MOBILE_IMAGE'),
          landscape_layout2x1_mainImage: getCellValue('LANDSCAPE_LAYOUT_2X1_MAIN_IMAGE'),
          landscape_layout2x1_mobileImage: getCellValue('LANDSCAPE_LAYOUT_2X1_MOBILE_IMAGE'),
          landscape_layout2x1_guestMainImage: getCellValue('LANDSCAPE_LAYOUT_2X1_GUEST_MAIN_IMAGE'),
          landscape_layout2x1_guestMobileImage: getCellValue('LANDSCAPE_LAYOUT_2X1_GUEST_MOBILE_IMAGE'),
          landscape_layout2x2_mainImage: getCellValue('LANDSCAPE_LAYOUT_2X2_MAIN_IMAGE'),
          landscape_layout2x2_mobileImage: getCellValue('LANDSCAPE_LAYOUT_2X2_MOBILE_IMAGE'),
          landscape_layout2x2_guestMainImage: getCellValue('LANDSCAPE_LAYOUT_2X2_GUEST_MAIN_IMAGE'),
          landscape_layout2x2_guestMobileImage: getCellValue('LANDSCAPE_LAYOUT_2X2_GUEST_MOBILE_IMAGE'),
          
          portrait_layout1x1_mainImage: portrait_layout1x1_mainImage,
          portrait_layout1x1_mobileImage: getCellValue('PORTRAIT_LAYOUT_1X1_MOBILE_IMAGE'),
          portrait_layout1x1_guestMainImage: getCellValue('PORTRAIT_LAYOUT_1X1_GUEST_MAIN_IMAGE'),
          portrait_layout1x1_guestMobileImage: getCellValue('PORTRAIT_LAYOUT_1X1_GUEST_MOBILE_IMAGE'),
          portrait_layout1x2_mainImage: getCellValue('PORTRAIT_LAYOUT_1X2_MAIN_IMAGE'),
          portrait_layout1x2_mobileImage: getCellValue('PORTRAIT_LAYOUT_1X2_MOBILE_IMAGE'),
          portrait_layout1x2_guestMainImage: getCellValue('PORTRAIT_LAYOUT_1X2_GUEST_MAIN_IMAGE'),
          portrait_layout1x2_guestMobileImage: getCellValue('PORTRAIT_LAYOUT_1X2_GUEST_MOBILE_IMAGE'),
          portrait_layout2x1_mainImage: getCellValue('PORTRAIT_LAYOUT_2X1_MAIN_IMAGE'),
          portrait_layout2x1_mobileImage: getCellValue('PORTRAIT_LAYOUT_2X1_MOBILE_IMAGE'),
          portrait_layout2x1_guestMainImage: getCellValue('PORTRAIT_LAYOUT_2X1_GUEST_MAIN_IMAGE'),
          portrait_layout2x1_guestMobileImage: getCellValue('PORTRAIT_LAYOUT_2X1_GUEST_MOBILE_IMAGE'),
          portrait_layout2x2_mainImage: getCellValue('PORTRAIT_LAYOUT_2X2_MAIN_IMAGE'),
          portrait_layout2x2_mobileImage: getCellValue('PORTRAIT_LAYOUT_2X2_MOBILE_IMAGE'),
          portrait_layout2x2_guestMainImage: getCellValue('PORTRAIT_LAYOUT_2X2_GUEST_MAIN_IMAGE'),
          portrait_layout2x2_guestMobileImage: getCellValue('PORTRAIT_LAYOUT_2X2_GUEST_MOBILE_IMAGE'),

          square_layout1x1_mainImage: getCellValue('SQUARE_LAYOUT_1X1_MAIN_IMAGE'),
          square_layout1x1_mobileImage: getCellValue('SQUARE_LAYOUT_1X1_MOBILE_IMAGE'),
          square_layout1x1_guestMainImage: getCellValue('SQUARE_LAYOUT_1X1_GUEST_MAIN_IMAGE'),
          square_layout1x1_guestMobileImage: getCellValue('SQUARE_LAYOUT_1X1_GUEST_MOBILE_IMAGE'),
          square_layout1x2_mainImage: getCellValue('SQUARE_LAYOUT_1X2_MAIN_IMAGE'),
          square_layout1x2_mobileImage: getCellValue('SQUARE_LAYOUT_1X2_MOBILE_IMAGE'),
          square_layout1x2_guestMainImage: getCellValue('SQUARE_LAYOUT_1X2_GUEST_MAIN_IMAGE'),
          square_layout1x2_guestMobileImage: getCellValue('SQUARE_LAYOUT_1X2_GUEST_MOBILE_IMAGE'),
          square_layout2x1_mainImage: getCellValue('SQUARE_LAYOUT_2X1_MAIN_IMAGE'),
          square_layout2x1_mobileImage: getCellValue('SQUARE_LAYOUT_2X1_MOBILE_IMAGE'),
          square_layout2x1_guestMainImage: getCellValue('SQUARE_LAYOUT_2X1_GUEST_MAIN_IMAGE'),
          square_layout2x1_guestMobileImage: getCellValue('SQUARE_LAYOUT_2X1_GUEST_MOBILE_IMAGE'),
          square_layout2x2_mainImage: getCellValue('SQUARE_LAYOUT_2X2_MAIN_IMAGE'),
          square_layout2x2_mobileImage: getCellValue('SQUARE_LAYOUT_2X2_MOBILE_IMAGE'),
          square_layout2x2_guestMainImage: getCellValue('SQUARE_LAYOUT_2X2_GUEST_MAIN_IMAGE'),
          square_layout2x2_guestMobileImage: getCellValue('SQUARE_LAYOUT_2X2_GUEST_MOBILE_IMAGE'),
          
          articleId: getCellValue('ARTICLE_ID'),
          mobileArticleId: getCellValue('MOBILE_ARTICLE_ID'),
          description: getCellValue('DESCRIPTION'),
          ['gameLabelsData_Drops and Wins']: getCellValue('GAMELABELS_DROPS_AND_WINS'),
          ['gameLabelsData_Rising Star']: getCellValue('GAMELABELS_RISING_STAR'),
          gameLabelsData_Exclusive: getCellValue('GAMELABELS_EXCLUSIVE'),
          gameLabelsData_New: getCellValue('GAMELABELS_NEW'),
          gamesCustomFields_provider: finalGameProvider,
          gamesCustomFields_externalProviderGameId: getCellValue('GAMESCUSTOMFIELDS_EXTERNALPROVIDERGAMEID'),
          gamesCustomFields_gameType: getCellValue('GAMESCUSTOMFIELDS_GAMETYPE'),
          gamesCustomFields_theme: getCellValue('GAMESCUSTOMFIELDS_THEME'),
          gamesCustomFields_features: getCellValue('GAMESCUSTOMFIELDS_FEATURES'),
          gamesCustomFields_volatility: getCellValue('GAMESCUSTOMFIELDS_VOLATILITY'),
          gamesCustomFields_rtp: getCellValue('GAMESCUSTOMFIELDS_RTP'),
          gamesCustomFields_lines: getCellValue('GAMESCUSTOMFIELDS_LINES'),
          gamesCustomFields_reels: getCellValue('GAMESCUSTOMFIELDS_REELS'),
        };
        processedGames.push(rowData);
      }
      return processedGames;
    }

    function generateCsvContent(
      data: ProcessedGameData[],
      columns: (keyof ProcessedGameData | 'gameLabelsData_Drops and Wins' | 'gameLabelsData_Rising Star')[]
    ): string {
      if (data.length === 0) return '';

      const header = columns.join('\t') + '\n';
      const rows = data.map(row => {
        return columns.map(col => {
          const value = row[col as keyof ProcessedGameData]; 
          
          if (typeof value === 'boolean') {
            return String(value).toLowerCase();
          }
          let cellValue = (value === undefined || value === null) ? '' : String(value);
          cellValue = cellValue.replace(/\t/g, ' ').replace(/\n/g, ' '); 
          return cellValue;
        }).join('\t');
      }).join('\n');

      return header + rows;
    }

    // --- ICONS ---
    const ClearIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        strokeWidth={1.5}
        stroke="currentColor"
        className="w-5 h-5"
        {...props}
      >
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12.56 0c1.153 0 2.243.096 3.222.261m3.222.261L8.85 3.55M11.882 3.55a48.147 48.147 0 014.288 0M5.106 5.79l-.007.005a48.294 48.294 0 01-.429 2.58M16.5 5.25h-9"
        />
      </svg>
    );
    const DownloadIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (
      <svg 
        xmlns="http://www.w3.org/2000/svg" 
        fill="none" 
        viewBox="0 0 24 24" 
        strokeWidth={1.5} 
        stroke="currentColor" 
        className="w-5 h-5"
        {...props}
      >
        <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
      </svg>
    );
    const KeyIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z" />
      </svg>
    );
    const ProcessIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (
      <svg 
        xmlns="http://www.w3.org/2000/svg" 
        fill="none" 
        viewBox="0 0 24 24" 
        strokeWidth={1.5} 
        stroke="currentColor" 
        className="w-5 h-5"
        {...props}
      >
        <path strokeLinecap="round" strokeLinejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
      </svg>
    );
    const SparklesIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        strokeWidth={1.5}
        stroke="currentColor"
        className="w-5 h-5"
        {...props}
      >
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.455-2.456L12.75 18l1.178-.398a3.375 3.375 0 002.455-2.456L16.5 14.25l.398 1.178a3.375 3.375 0 002.456 2.456l1.178.398-1.178.398a3.375 3.375 0 00-2.456 2.456z"
        />
      </svg>
    );
    const TableIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => (
      <svg 
        xmlns="http://www.w3.org/2000/svg" 
        fill="none" 
        viewBox="0 0 24 24" 
        strokeWidth={1.5} 
        stroke="currentColor" 
        className="w-6 h-6"
        {...props}
      >
        <path strokeLinecap="round" strokeLinejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5V7.5c0-.988.708-1.763 1.623-1.954C6.278 5.343 7.57 5.25 9 5.25h6c1.43 0 2.722.093 3.998.296C20.042 5.737 20.75 6.512 20.75 7.5v10.875m-17.25 0c0 .621.504 1.125 1.125 1.125h15c.621 0 1.125-.504 1.125-1.125m-17.25 0h17.25M3.75 9.75h16.5M3.75 12.75h16.5m-16.5 3h16.5" />
      </svg>
    );

    // --- COMPONENTS ---
    interface HeaderProps {
      title: string;
      subtitle?: string;
    }
    const Header: React.FC<HeaderProps> = ({ title, subtitle }) => {
      return (
        <header className="w-full max-w-5xl text-center py-8">
          <img
            src="https://digibeat.com/wp-content/uploads/2022/06/logo-white-300x80.png"
            alt="Digibeat Logo"
            className="h-16 mx-auto mb-6"
          />
          <h1 className="text-4xl font-bold text-[#66acde] sm:text-5xl">{title}</h1>
          {subtitle && <p className="mt-3 text-lg text-slate-400 sm:text-xl">{subtitle}</p>}
        </header>
      );
    };

    interface TextInputAreaProps {
      value: string;
      onChange: (value: string) => void;
      placeholder?: string;
      rows?: number;
    }
    const TextInputArea: React.FC<TextInputAreaProps> = ({ value, onChange, placeholder, rows = 10 }) => {
      return (
        <textarea
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder={placeholder}
          rows={rows}
          className="w-full p-3 bg-slate-700 border border-slate-600 rounded-md shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 text-slate-100 placeholder-slate-400 transition-colors"
          spellCheck="false"
        />
      );
    };

    interface ActionButtonProps {
      onClick: () => void;
      disabled?: boolean;
      children: React.ReactNode;
      icon?: React.ReactNode;
      className?: string;
      title?: string;
    }
    const ActionButton: React.FC<ActionButtonProps> = ({
      onClick,
      disabled = false,
      children,
      icon,
      className = 'bg-sky-600 hover:bg-sky-500',
      title
    }) => {
      return (
        <button
          onClick={onClick}
          disabled={disabled}
          title={title}
          className={`
            flex items-center justify-center px-6 py-3 border border-transparent 
            text-base font-medium rounded-md shadow-sm text-white 
            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-[#66acde]
            disabled:opacity-50 disabled:cursor-not-allowed
            transition-all duration-150 ease-in-out
            ${className}
          `}
        >
          {icon && <span className="mr-2 h-5 w-5">{icon}</span>}
          {children}
        </button>
      );
    };
    
    interface DataTableProps {
      data: ProcessedGameData[];
      columns: (keyof ProcessedGameData | 'gameLabelsData_Drops and Wins' | 'gameLabelsData_Rising Star')[];
    }
    const columnDisplayNames: Partial<Record<keyof ProcessedGameData | 'gameLabelsData_Drops and Wins' | 'gameLabelsData_Rising Star', string>> = {
      gameCode: "Game Code", name: "Name", isActive: "Active", mobileGameCode: "Mobile Game Code",
      seoFriendlyGameName: "SEO Friendly Name", defaultGameImage: "Default Game Image URL", gameProvider: "Game Provider",
      desktopGameType: "Desktop Type", mobileGameType: "Mobile Type", liveLaunchAlias: "Live Launch Alias", 
      bingoGameType: "Bingo Type", vfGameType: "VF Game Type", jackpotCode: "Jackpot Code",
      demoModeSupport: "Demo Mode Support", gameMode: "Game Mode", urlCustomParameters: "URL Custom Params",
      isExcludedFromPGG: "Excluded PGG", isExcludedFromSitemap: "Excluded Sitemap",
      deviceAvailability_mobile: "Mobile Available", deviceAvailability_tablet: "Tablet Available", deviceAvailability_desktop: "Desktop Available",
      browserAvailability_edge: "Edge Available", browserAvailability_safari: "Safari Available", browserAvailability_chrome: "Chrome Available",
      browserAvailability_firefox: "Firefox Available", browserAvailability_other: "Other Browser Available",
      osAvailability_ios: "iOS Available", osAvailability_macintosh: "Mac Available", osAvailability_android: "Android Available",
      osAvailability_windows: "Windows Available", osAvailability_other: "Other OS Available",
      landscape_layout1x1_mainImage: "L 1x1 Main", portrait_layout1x1_mainImage: "P 1x1 Main", square_layout1x1_mainImage: "S 1x1 Main",
      articleId: "Article ID", mobileArticleId: "Mobile Article ID", description: "Description",
      isGameNew: "Is Game New", isGamePopular: "Popular", isGameHot: "Hot", isGameExclusive: "Game Exclusive",
      'gameLabelsData_Drops and Wins': "Drops & Wins Label", 'gameLabelsData_Rising Star': "Rising Star Label",
      gameLabelsData_Exclusive: "Exclusive Label", gameLabelsData_New: "New Label",
      gamesCustomFields_provider: "Custom Provider", gamesCustomFields_externalProviderGameId: "Custom Ext. Provider ID",
      gamesCustomFields_gameType: "Game Type", gamesCustomFields_theme: "Theme", gamesCustomFields_features: "Features",
      gamesCustomFields_volatility: "Volatility", gamesCustomFields_rtp: "RTP", gamesCustomFields_lines: "Lines",
      gamesCustomFields_reels: "Reels",
    };
    const DataTable: React.FC<DataTableProps> = ({ data, columns }) => {
      if (!data || data.length === 0) {
        return <p className="text-slate-400 italic">No data to display.</p>;
      }

      return (
        <div className="overflow-x-auto bg-slate-700 rounded-md shadow">
          <table className="min-w-full divide-y divide-slate-600">
            <thead className="bg-slate-800">
              <tr>
                {columns.map((key) => (
                  <th key={String(key)} scope="col" className="px-4 py-3 text-left text-xs font-medium text-sky-300 uppercase tracking-wider whitespace-nowrap">
                    {columnDisplayNames[key] || String(key).replace(/_/g, ' ')}
                  </th>
                ))}
              </tr>
            </thead>
            <tbody className="bg-slate-700 divide-y divide-slate-600">
              {data.map((row, rowIndex) => (
                <tr key={rowIndex} className={`${rowIndex % 2 === 0 ? 'bg-slate-700' : 'bg-slate-800'} hover:bg-slate-600 transition-colors`}>
                  {columns.map((key) => (
                    <td key={String(key)} className="px-4 py-3 whitespace-nowrap text-sm text-slate-200">
                      {typeof row[key as keyof ProcessedGameData] === 'string' && (row[key as keyof ProcessedGameData] as string).includes('/library/') ? (
                        <a href={String(row[key as keyof ProcessedGameData])} target="_blank" rel="noopener noreferrer" className="text-[#66acde] transition-opacity hover:opacity-80 hover:underline break-all" title={String(row[key as keyof ProcessedGameData])}>
                          {String(row[key as keyof ProcessedGameData]).length > 50 ? String(row[key as keyof ProcessedGameData]).substring(0, 47) + '...' : String(row[key as keyof ProcessedGameData])}
                        </a>
                      ) : (
                        String(row[key as keyof ProcessedGameData] === undefined || row[key as keyof ProcessedGameData] === null ? '' : row[key as keyof ProcessedGameData])
                      )}
                    </td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    };

    // --- APP COMPONENT ---
    const App: React.FC = () => {
      const [apiKey, setApiKey] = useState<string>('');
      const [rawText, setRawText] = useState<string>('');
      const [processedData, setProcessedData] = useState<ProcessedGameData[]>([]);
      const [error, setError] = useState<string | null>(null);
      const [isLoading, setIsLoading] = useState<boolean>(false);
      const [isEnriching, setIsEnriching] = useState<boolean>(false);

      const handleProcessData = useCallback(async (providerMapToUse: GameProviderFolderMapping, context: string) => {
        if (!rawText.trim()) {
          setError("Input data cannot be empty.");
          setProcessedData([]);
          return;
        }
        setIsLoading(true);
        setError(null);
        setProcessedData([]);

        try {
          await new Promise(resolve => setTimeout(resolve, 100)); 
          const data = parsePastedData(rawText, providerMapToUse);
          setProcessedData(data);
          if (data.length === 0 && !error) { 
             setError("No valid data rows found or core required headers are missing. " + PLACEHOLDER_INFO_REQUIRED_COLUMNS);
          }
        } catch (e) {
          if (e instanceof Error) {
            setError(`Error processing data: ${e.message}`);
          } else {
            setError("An unknown error occurred during processing.");
          }
          setProcessedData([]);
        } finally {
          setIsLoading(false);
        }
      }, [rawText, error]);

      const handleEnrichData = useCallback(async () => {
        if (processedData.length === 0) {
          setError("No data to enrich.");
          return;
        }
        if (!apiKey.trim()) {
          setError("Please enter a Google AI API key to use the AI enrichment feature.");
          return;
        }

        setIsEnriching(true);
        setError(null);

        try {
          const ai = new GoogleGenAI({ apiKey: apiKey });
          
          const responseSchema = {
            type: Type.OBJECT, properties: {
              gameType: { type: Type.STRING, description: "Game category (e.g., 'Slots', 'Progressive Slots', 'Blackjack', 'Roulette', 'Tap', 'Slingo')." },
              volatility: { type: Type.STRING, description: "Volatility rating from 1 to 8 (e.g., '2', '4', '6', '8')." },
              lines: { type: Type.STRING, description: "Number of paylines or ways (e.g., '243', 'Cluster Pays')." },
              reels: { type: Type.STRING, description: "Number of reels (e.g., '5', '3', 'Cluster Pays')." },
              theme: { type: Type.ARRAY, description: "List of themes for the game from the allowed list.", items: { type: Type.STRING } },
              features: { type: Type.ARRAY, description: "List of key features for the game from the allowed list.", items: { type: Type.STRING } },
            }
          };

          const enrichmentPromises = processedData.map(async (game) => {
            if (game.gamesCustomFields_gameType && game.gamesCustomFields_theme) {
                return game;
            }

            const prompt = `
Analyze the casino game named '${game.name}' from provider '${game.gameProvider}'. Preserve all special characters (™, ®, ©) in the name. Provide the following details based on the strict rules below.
**Game Information Rules:**
1.  **gameType**: The primary category. Use "Slots" for standard slots, "Progressive Slots" if it has a major progressive jackpot. Other options: "Blackjack", "Roulette", "Tap", "Slingo".
2.  **volatility**: A number on a scale of 1 to 8. Use these mappings: Low=2, Medium=4, Medium-High=6, High/Very High=8.
3.  **lines**: The number of paylines or ways (e.g., "20", "243", "117649", "Cluster Pays").
4.  **reels**: The number of reels. THIS IS CRITICAL. Be exceptionally accurate. Cross-reference multiple sources. Classic/retro slots are often 3 reels.
5.  **theme**: A list of themes selected ONLY from the 'Allowed Themes' list.
6.  **features**: A list of prominent features (max 20) selected ONLY from the 'Allowed Features' list.
**Allowed Themes:**
"Asian", "Egypt", "Mythology", "Animals", "Buffalos", "Vegas Vibes", "Adventure", "Fantasy", "Gems", "Fruits", "Wild West", "Irish", "Magic", "Sci-Fi", "Horror", "Money", "Pirates", "Candy", "Fishing", "Rome", "Pigs", "Barnyard Bonanza", "Greek Gods", "Retro Reels".
**Allowed Features:**
"Megaways", "Hold and Win", "Cash Collect", "Link&Win", "Cluster Pays", "Jackpot", "Expanding Wilds", "Sticky Wilds", "Cascading Reels", "Colossal Symbols", "Multipliers", "Respins", "Infinity Reels", "Ways to Win", "Split Symbols", "Nudging Wilds", "Power Reels", "Gigablox", "InfiniReels", "Bonus Wheel".
**IMPORTANT SPECIFIC RULES:**
*   **DO NOT** list "Free Spins", "Bonus Buy", "Bonus Game", or "Gamble" as features.
*   If a game has **3 reels**, its themes MUST include "Retro Reels".
*   If a game is based on Greek mythology (e.g., 'Age of the Gods', 'Gates of Olympus'), its themes MUST include both 'Mythology' and 'Greek Gods'.
*   If a game has a clear Chinese or other East Asian name or theme, its theme MUST include "Asian".
*   If a game's main subject is buffalos, its themes MUST include 'Animals' and 'Buffalos'.
*   If a game features pigs, its themes MUST include 'Animals', 'Pigs', and 'Barnyard Bonanza'.
*   If a game is known to be available in land-based casinos, its themes MUST include "Vegas Vibes".
*   If info is not available for a field: return an empty string for text fields, and an empty list for list fields. Do not use "N/A".
`;

            try {
              const response = await ai.models.generateContent({
                model: "gemini-2.5-flash", contents: prompt,
                config: { responseMimeType: "application/json", responseSchema: responseSchema },
              });
              const jsonText = response.text.trim();
              const enrichedData = JSON.parse(jsonText);
              return {
                ...game,
                gamesCustomFields_gameType: enrichedData.gameType || game.gamesCustomFields_gameType,
                gamesCustomFields_theme: enrichedData.theme?.join(', ') || game.gamesCustomFields_theme,
                gamesCustomFields_features: enrichedData.features?.join(', ') || game.gamesCustomFields_features,
                gamesCustomFields_volatility: enrichedData.volatility || game.gamesCustomFields_volatility,
                gamesCustomFields_lines: enrichedData.lines || game.gamesCustomFields_lines,
                gamesCustomFields_reels: enrichedData.reels || game.gamesCustomFields_reels,
              };
            } catch (e) {
              console.error(`Could not enrich data for ${game.name}:`, e);
              return game;
            }
          });
          const enrichedResults = await Promise.all(enrichmentPromises);
          setProcessedData(enrichedResults);
        } catch (e) {
          if (e instanceof Error) {
            setError(`Error during AI enrichment: ${e.message}`);
          } else {
            setError("An unknown error occurred during AI enrichment.");
          }
        } finally {
          setIsEnriching(false);
        }
      }, [processedData, apiKey]);

      const handleDownloadCsv = useCallback(() => {
        if (processedData.length === 0) {
          setError("No data to download.");
          return;
        }
        try {
          const csvContent = generateCsvContent(processedData, OUTPUT_CSV_COLUMNS);
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement("a");
          const url = URL.createObjectURL(blob);
          const now = new Date();
          const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;
          const fileName = `processed_game_data_${timestamp}.csv`;
          link.setAttribute("href", url);
          link.setAttribute("download", fileName);
          link.style.visibility = 'hidden';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        } catch (e) {
          if (e instanceof Error) { setError(`Error generating CSV: ${e.message}`); } 
          else { setError("An unknown error occurred while generating CSV."); }
        }
      }, [processedData]);

      const handleClearData = useCallback(() => {
        setRawText('');
        setProcessedData([]);
        setError(null);
      }, []);

      return (
        <div className="min-h-screen bg-slate-900 text-slate-100 flex flex-col items-center p-4 selection:bg-sky-500 selection:text-white">
          <Header title={APP_TITLE} subtitle="Paste tab-separated game data from Monday.com." />
          
          <main className="w-full max-w-5xl mt-8 space-y-8">
            <section className="bg-slate-800 p-6 rounded-lg shadow-xl">
              <div className="flex items-center mb-4">
                <KeyIcon className="w-6 h-6 text-[#66acde]" />
                <h2 className="text-2xl font-semibold text-[#66acde] ml-3">API Key Configuration</h2>
              </div>
              <p className="text-slate-400 mb-4 text-sm">Enter your Google AI API key to enable the "Enrich with AI" feature.</p>
              <input
                type="password"
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
                placeholder="Enter your Google AI API Key here..."
                className="w-full p-3 bg-slate-700 border border-slate-600 rounded-md shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 text-slate-100 placeholder-slate-400 transition-colors"
                aria-label="Google AI API Key"
              />
            </section>
            
            <section className="bg-slate-800 p-6 rounded-lg shadow-xl">
              <h2 className="text-2xl font-semibold text-[#66acde] mb-4">1. Paste Game Data</h2>
              <p className="text-slate-400 mb-4 text-sm">Input to include: Name, Game Provider, IMS Game Code, Portrait Tile, and Landscape tile.</p>
              <TextInputArea
                value={rawText}
                onChange={setRawText}
                placeholder={`Paste your tab-separated game data here. Ensure the first row contains all necessary headers. ${PLACEHOLDER_INFO_REQUIRED_COLUMNS}`}
              />
              <div className="mt-6 flex flex-wrap gap-4 items-center">
                <ActionButton onClick={() => handleProcessData(GAME_PROVIDER_TO_FOLDER_MAP_CA, ".CA")} disabled={isLoading || !rawText.trim()} className="bg-sky-600 hover:bg-sky-500 disabled:bg-sky-800 disabled:text-slate-500 transition-colors" icon={<ProcessIcon />}>
                  {isLoading ? 'Processing...' : 'Process: .CA'}
                </ActionButton>
                <ActionButton onClick={() => handleProcessData(GAME_PROVIDER_TO_FOLDER_MAP_COM, ".COM")} disabled={isLoading || !rawText.trim()} className="bg-indigo-600 hover:bg-indigo-500 disabled:bg-indigo-800 disabled:text-slate-500 transition-colors" icon={<ProcessIcon />}>
                  {isLoading ? 'Processing...' : 'Process: .COM'}
                </ActionButton>
                <ActionButton onClick={handleClearData} disabled={!rawText.trim() && processedData.length === 0 && !error} className="bg-amber-600 hover:bg-amber-500 disabled:bg-amber-800 disabled:text-slate-500 transition-colors ml-auto" icon={<ClearIcon />} title="Clear input and results">
                  Clear Data
                </ActionButton>
              </div>
            </section>

            {error && (
              <section className="bg-red-800 p-4 rounded-lg shadow-md text-red-100">
                <h3 className="font-semibold">Error:</h3>
                <p>{error}</p>
              </section>
            )}

            {isLoading && (<div className="flex justify-center items-center p-6"><div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#66acde]"></div><p className="ml-3 text-sky-300">Processing data, please wait...</p></div>)}
            {isEnriching && (<div className="flex justify-center items-center p-6"><div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-fuchsia-500"></div><p className="ml-3 text-fuchsia-300">🤖 Gathering game info with AI... This might take a moment.</p></div>)}

            {!isLoading && processedData.length > 0 && (
              <section className="bg-slate-800 p-6 rounded-lg shadow-xl">
                <div className="flex items-center mb-4">
                  <TableIcon className="w-8 h-8 text-[#66acde] mr-3" />
                  <h2 className="text-2xl font-semibold text-[#66acde]">2. Processed Data Preview</h2>
                </div>
                <DataTable data={processedData} columns={OUTPUT_CSV_COLUMNS} />
                 <div className="flex flex-wrap gap-4 mt-6">
                    <ActionButton onClick={handleDownloadCsv} disabled={processedData.length === 0 || isEnriching} className="bg-emerald-600 hover:bg-emerald-500 disabled:bg-emerald-800 disabled:text-slate-500 transition-colors" icon={<DownloadIcon />}>
                      Download CSV
                    </ActionButton>
                    <ActionButton onClick={handleEnrichData} disabled={!apiKey.trim() || processedData.length === 0 || isLoading || isEnriching} className="bg-fuchsia-600 hover:bg-fuchsia-500 disabled:bg-fuchsia-800 disabled:text-slate-500 transition-colors" icon={<SparklesIcon />} title={!apiKey.trim() ? "Enter an API Key to enable this feature" : "Use AI to find and fill in missing game details"}>
                      {isEnriching ? 'Enriching...' : '✨ Enrich with AI'}
                    </ActionButton>
                </div>
              </section>
            )}
             {!isLoading && processedData.length === 0 && rawText.trim() && !error && (
                <section className="bg-slate-800 p-6 rounded-lg shadow-xl text-center">
                     <p className="text-slate-400">No data to display. Please check your input or click one of the process buttons. If you've processed data and see this, there might have been no valid rows meeting criteria.</p>
                </section>
            )}
          </main>
           <footer className="w-full max-w-5xl mt-12 py-6 border-t border-slate-700 text-center text-sm text-slate-500">
            <p>&copy; {new Date().getFullYear()} Created by Bob Fox. Built with React & Tailwind CSS.</p>
          </footer>
        </div>
      );
    };

    // --- RENDERER ---
    const rootElement = document.getElementById('root');
    if (!rootElement) {
      throw new Error("Could not find root element to mount to");
    }

    const root = ReactDOM.createRoot(rootElement);
    root.render(
      <React.StrictMode>
        <App />
      </React.StrictMode>
    );

  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>